<div class="mat-dialog-heading" *ngIf="!creatingAd">
  <h2 mat-dialog-title>{{ data.label }}</h2>
  <span (click)="close()"> <em class="pixel-icons icon-close"></em> </span>
</div>

<div class="mat-dialog-content" *ngIf="!creatingAd && formReady">
  <form [formGroup]="createAdForm" class="modal-container">
    <div class="ad-form-attributes" formArrayName="adDetailsFormValues">
      <div
        class="form-attributes"
        *ngFor="let field of state.section; let i = index"
        [ngClass]="[
          field.db_column_key == 'divisions' ? 'full-width-field' : '',
          field.db_column_key == 'theme' ? 'half-width-field' : ''
        ]"
      >
        <pi-form-field [formGroupName]="i">
          <label class="label-name">{{ field.label | titlecase }}</label>
          <span
            class="required"
            *ngIf="field.form_save_value.settings.mandatory"
            >*</span
          >
          <div class="structure-select" *ngIf="field.key == 'single_line_text'">
            <input
              type="text"
              formControlName="{{ field.db_column_key }}"
              pi-input
            />
            <div
              class="error pi-error"
              *ngIf="errorMsg != '' && field.label == 'Ad Name'"
            >
              {{ errorMsg }}
            </div>
            <div
              class="pi-error"
              *ngIf="
                (createAdForm.controls.adDetailsFormValues.controls[i].controls[
                  field.db_column_key
                ].hasError('required') ||
                  createAdForm.controls.adDetailsFormValues.controls[
                    i
                  ].controls[field.db_column_key].hasError('whitespace')) &&
                submitted
              "
            >
              Please Enter {{ field.label | titlecase }}
            </div>
          </div>
          <div class="structure-select" *ngIf="field.key == 'number'">
            <input
              type="text"
              formControlName="{{ field.db_column_key }}"
              (input)="valChanged()"
              pi-input
              (keypress)="allowNumber($event)"
            />
          </div>
          <div class="structure-select" *ngIf="field.key == 'auto_suggest'">
            <input
              type="text"
              formControlName="{{ field.db_column_key }}"
              pi-input
              [matAutocomplete]="auto"
            />
            <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayFn">
              <mat-option
                *ngFor="let option of (filteredOptions | async)"
                [value]="option"
              >
                {{ option.name }}
              </mat-option>
            </mat-autocomplete>
          </div>
          <div class="structure-select" *ngIf="field.key == 'date'">
            <div class="date-picker-field">
              <input
                class="datepicker"
                (click)="openCalendar(picker)"
                readonly="true"
                [min]="minDate[field.db_column_key]"
                [max]="maxDate[field.db_column_key]"
                placeholder="Select Date"
                formControlName="{{ field.db_column_key }}"
                [disabled]="disableStatus[field.db_column_key]"
                (focus)="openCalendar(picker)"
                (dateChange)="dateValueChange(field, $event, createAdForm)"
                [matDatepicker]="picker"
                pi-input
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div>

            <!-- <div class="date-picker-field" *ngIf="field.db_column_key == 'start_date'">
              <input class="datepicker" (click)="openCalendar(picker)" readonly="true" [min]="minDate[field.db_column_key]"
                [max]="maxDate[field.db_column_key]" placeholder="Select Date" formControlName="{{ field.db_column_key }}"
                (focus)="openCalendar(picker)" (dateChange)="dateValueChange(field, $event)" [matDatepicker]="picker"
                pi-input />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div>
            <div class="date-picker-field" *ngIf="field.db_column_key == 'break_date'">
              <input id="end_date" class="datepicker" (click)="openCalendar(picker)" readonly="true"
                [min]="minDate['break_date']" [max]="maxDate['break_date']" placeholder="Select Date"
                formControlName="{{ field.db_column_key }}" (focus)="openCalendar(picker)"
                (dateChange)="dateValueChange(field, $event)" [matDatepicker]="picker" pi-input />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div>
            <div class="date-picker-field" *ngIf="field.db_column_key == 'end_date'">
              <input class="datepicker" (click)="openCalendar(picker)" readonly="true" [min]="minDate['end_date']"
                [max]="maxDate['end_date']" placeholder="Select Date" formControlName="{{ field.db_column_key }}"
                (focus)="openCalendar(picker)" (dateChange)="dateValueChange(field, $event)" [matDatepicker]="picker"
                pi-input />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div>
            <div class="date-picker-field" *ngIf="field.db_column_key == 'first_proof_date'">
              <input class="datepicker" (click)="openCalendar(picker)" readonly="true" [min]="minDate['first_proof']"
                [max]="maxDate['first_proof']" placeholder="Select Date" formControlName="{{ field.db_column_key }}"
                (focus)="openCalendar(picker)" (dateChange)="dateValueChange(field, $event)" [matDatepicker]="picker"
                pi-input />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div>
            <div class="date-picker-field" *ngIf="field.db_column_key == 'second_proof_date'">
              <input class="datepicker" (click)="openCalendar(picker)" readonly="true" [min]="minDate['second_proof']"
                [max]="maxDate['second_proof']" placeholder="Select Date" formControlName="{{ field.db_column_key }}"
                (focus)="openCalendar(picker)" (dateChange)="dateValueChange(field, $event)" [matDatepicker]="picker"
                pi-input />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div>
            <div class="date-picker-field" *ngIf="field.db_column_key == 'final_proof_date'">
              <input class="datepicker" (click)="openCalendar(picker)" readonly="true" [min]="minDate['final_proof']"
                [max]="maxDate['final_proof']" placeholder="Select Date" formControlName="{{ field.db_column_key }}"
                (focus)="openCalendar(picker)" (dateChange)="dateValueChange(field, $event)" [matDatepicker]="picker"
                pi-input />
              <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </div> -->
            <div class="date-picker-icon-sec">
              <div class="date-picker-icon"></div>
            </div>
          </div>
          <div class="structure-select" *ngIf="field.key == 'button'">
            <div>
              <mat-button-toggle-group
                [disabled]="disableCheck"
                formControlName="{{ field.db_column_key }}"
              >
                <mat-button-toggle [value]="1"> Active</mat-button-toggle>
                <mat-button-toggle [value]="2"> Inactive</mat-button-toggle>
              </mat-button-toggle-group>
            </div>
          </div>
          <ng-container *ngIf="field.key == 'dropdown'">
            <pi-select
              *ngIf="field.db_column_key != 'channel_type_id'"
              [options]="field.options"
              formControlName="{{ field.db_column_key }}"
              (onChange)="valChanged(field.db_column_key, event)"
            ></pi-select>
          </ng-container>
          <ng-container *ngIf="field.key == 'multiple_choice'">
            <!-- <pi-select [options]="divisionsList" formControlName="{{ field.db_column_key }}"
              *ngIf="field.db_column_key == 'divisions'" (onChange)="valChanged()" nameKey="divname" [multi]="true"
              class="divsions_list"></pi-select>
            <pi-select [options]="divisionsList" formControlName="{{ field.db_column_key }}"
              *ngIf="field.db_column_key == 'unique_ad_id'" (onChange)="valChanged()" nameKey="divname" [multi]="true"
              class="divsions_list"></pi-select> -->
            <pi-select
              [options]="field.options"
              formControlName="{{ field.db_column_key }}"
              (onChange)="valChanged(field.db_column_key)"
              [(ngModel)]="selectedzones"
              [multi]="true"
              class="divsions_list"
            ></pi-select>
          </ng-container>
          <div *ngIf="field.key == 'paragraph_text'">
            <textarea
              rows="3"
              pi-input
              formControlName="{{ field.db_column_key }}"
              (input)="valChanged()"
            ></textarea>
          </div>
          <div *ngIf="field.key == 'autocomplete'">
            <input
              matInput
              placeholder="State"
              [matAutocomplete]="auto"
              formControlName="{{ field.db_column_key }}"
            />
            <mat-autocomplete #auto="matAutocomplete">
              <mat-option
                *ngFor="let state of (campaignData | async)"
                [value]="state.name"
              >
                {{ state }} <span>{{ state.name }}</span> |
              </mat-option>
            </mat-autocomplete>
          </div>
          <div *ngIf="field.key == 'checkboxes'">
            <div *ngFor="let option of field.options">
              <pi-form-field label="{{ option.value }}">
                <input
                  type="checkbox"
                  pi-input
                  formControlName="{{ field.db_column_key }}"
                />
              </pi-form-field>
            </div>
            <div *ngIf="!field.options.length">no options found.</div>
          </div>
        </pi-form-field>
        <div
          class="pi-error"
          *ngIf="
            createAdForm.controls.adDetailsFormValues.controls[i].controls[
              field.db_column_key
            ].hasError('required') &&
            submitted &&
            field.key != 'single_line_text'
          "
        >
          Please Select {{ field.label | titlecase }}
        </div>
        <div
          class="pi-error"
          *ngIf="
            createAdForm.controls.adDetailsFormValues.controls[i].controls[
              field.db_column_key
            ].invalid &&
            submitted &&
            createAdForm.controls.adDetailsFormValues.controls[i].controls[
              field.db_column_key
            ].value != '' &&
            field.db_column_key == 'week_no'
          "
        >
          Week Number should be from 1-53
        </div>
      </div>
    </div>

    <div>
      <pi-form-field
        label="Copy Layouts Only"
        *ngIf="data.from == 'duplicate_ad'"
      >
        <input type="checkbox" pi-input (change)="onChekChange($event)" />
      </pi-form-field>
    </div>
  </form>
</div>
<div class="mat-dialog-footer">
  <div class="error-msg">
    <div class="pi-error" *ngIf="errorMsg != ''">{{ errorMsg }}</div>
  </div>

  <div class="button-actions box" *ngIf="!creatingAd && formReady">
    <button pi-button (click)="close()" color="subtle">Cancel</button>

    <button
      pi-button
      color="accent"
      class="apply-btn"
      (click)="createAdd(createAdForm)"
      [disabled]="createAdForm.pristine"
    >
      {{ data.label }}
    </button>
  </div>
</div>
<div class="loader" *ngIf="creatingAdloader && creatingAd"></div>
<div class="success" *ngIf="!creatingAdloader && creatingAd">
  <mat-icon>check_circle</mat-icon>
</div>
<div class="loader-text no-data-grid" *ngIf="creatingAd">{{ loadingMsg }}</div>
